#!/bin/bash

if [ -z "$1" ]; then
    echo "Must pass a run name. Usage: ont_combine [RUN_NAME]"
    exit 1
fi

# The directory where scripts are stored
SCRIPT_DIR=$BRIDGE_SCRIPT_DIR
# The directory where sequence run subdirectories are installed
WORKING_DIR=$BRIDGE_WORKING_DIR

COMBINE_SCRIPT="$SCRIPT_DIR/ont_combine_fastq.sh"
NAME_DIR="$WORKING_DIR/share_file_templates"
RENAME_FILE="$NAME_DIR/renaming.tsv"
RUN_NAME="$1"
RUN_DIR="$WORKING_DIR/$RUN_NAME"
FASTQ_PASS_DIR="$RUN_DIR/fastq_pass"
FASTQ_PASS_MERGED_DIR="$FASTQ_PASS_DIR/fastq_pass_merged"


if [ ! -d $SCRIPT_DIR ]; then
    echo "Directory $SCRIPT_DIR does not exist."
    exit 1
fi

if [ ! -d $WORKING_DIR ]; then
    echo "Directory $WORKING_DIR does not exist."
    exit 1
fi

if [ ! -d $RUN_DIR ]; then
    echo "Directory $RUN_DIR does not exist."
    exit 1
fi

echo "I'm running"

dos2unix $RENAME_FILE
bash $COMBINE_SCRIPT $FASTQ_PASS_DIR $FASTQ_PASS_MERGED_DIR $RENAME_FILE file

seqkit stats -abT $FASTQ_PASS_MERGED_DIR/*.fastq.gz > $FASTQ_PASS_MERGED_DIR/read_stats
